<html>

<head>

	<link rel="stylesheet" href="<?php echo base_url('assets/css/bootstrap.css'); ?>" />
	<link rel="stylesheet" href="<?php echo base_url('assets/css/clock.css'); ?>" />
	<link rel="stylesheet" href="<?php echo base_url('assets/css/overview.css'); ?>" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Anton&family=Orbitron&display=swap" rel="stylesheet">
</head>

<body style="background-color: black;" class="overflow-auto">
	<div style="z-index: -5;left: 0 ;" class="position-absolute">
		<img src="<?php echo base_url('assets/images/OverView/jet.png'); ?>" class="img-fluid " alt="..."
			style="width: 50vw; transform: translateY(-50%);">

	</div>
	<div style="z-index: -5;right: 0 ;" class="position-absolute">
		<img src="<?php echo base_url('assets/images/OverView/jet.png'); ?>" class="img-fluid " alt="..."
			style="width: 50vw; transform: translateY(-70%);">

	</div>
	<div class="shadow-top"
		style="height: 12vh; z-index: -1 ;width: 50vw; background-color: black; position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-radius: 0 0 25px 25px;">
	</div>

	<div class="navbar"
		style="height: 14vh; width: 60vw; z-index: -2;position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-radius: 0 0 25px 25px;">
	</div>

		<div class="row" style="margin: 10px;" data-bs-interval="">
			<div class="col-3 text-white">
				<span>
					<img src="<?php echo base_url('assets/images/OverView/bcc_logo.png'); ?>" class="img-fluid " alt="..."
						style="max-height: 14vh;">
				</span>
			</div>
			<div class="row col-6">

				<div class="col-8">
					<div class="time" id="time" data-hours="" data-minutes="">
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
						<div class="digit">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
					</div>
				</div>
				<div class="col-4 text-white row">
					<div class="col-8">
						<div>
							<div style="font-style: italic;">Game time</div>
						</div>
						<div class="day" style="font-size: 36px;">
							<span style="background-color: white; color: black;">8</span>
							<span>:</span>
							<span>0</span>
							<span>0</span>
						</div>
					</div>
					<div class="col-4">
						<div style="font-style: italic;">Day</div>
						<div class="day-numeral">7</div>
					</div>


				</div>
			</div>

			<div class="col-3 text-white">
				<div style="position: absolute; right: 0;">
					<img src="<?php echo base_url('assets/images/OverView/navy.png'); ?>" class="img-fluid" alt="..."
						style="max-height: 14vh;">


				</div>

			</div>

		</div>
		<div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
			<div class="carousel-inner">
				<div class="carousel-item active" data-bs-interval="5000">
					<div class="card-group">
						<div class="card">
							<div class="row">
								<div class="col">
									<img src="<?php echo base_url('assets/images/OverView/usa.png'); ?>"
										class="img-fluid border" alt="..." style="margin: 5px;">
								</div>
								<div class="col" style="margin-top: 5px; margin-right: 5px;">
									<ul class="list-group">
										<li class="list-group-item">
											<span class="text-bold">
												Available assets
											</span>
											<span id="usa-available">
												1,110,000
											</span>
										</li>
										<li class="list-group-item">
											<span class="text-bold">
												Destroyed assets
											</span>
											<span id="usa-destroyed">
												10,000
											</span>
										</li>

									</ul>
									<div style="font-size: 40px; margin-top: 5px;" class="text-bold defcon-3"
										id="usa-defcon" data-defcon="3">
										<?php if($Objectives->num_rows()>0){echo $Objectives->row()->defcon; }  ?>
									</div>

								</div>
							</div>

							<div class="card-body">
								<ul class="list-group" id="blue">
									<?php
							foreach($Objectives->result() as $row){
								if($row->country=="USA"){
						?>
									<li class="list-group-item">
										<?php echo $row->objective; ?>
									</li>

									<?php 
								}
							} 
						?>
								</ul>
							</div>
							

							
						</div>
						<div class="card">
							<div class="row">
								<div class="col">
									<img src="<?php echo base_url('assets/images/OverView/india.png'); ?>"
										class="img-fluid border" alt="..." style="margin: 5px;">

								</div>
								<div class="col" style="margin-top: 5px; margin-right: 5px;">
									<ul class="list-group">
										<li class="list-group-item">
											<span class="text-bold">
												Available assets
											</span>
											<span id="india-available">
												1,110,000
											</span>
										</li>
										<li class="list-group-item">
											<span class="text-bold">
												Destroyed assets
											</span>
											<span id="india-destroyed">
												10,000
											</span>
										</li>

									</ul>
									<div style="font-size: 40px; margin-top: 5px;" class="text-bold defcon-4"
										id="india-defcon" data-defcon="4">
										<?php if($Objectives->num_rows()>0){echo $Objectives->row()->defcon; }  ?>
									</div>

								</div>
							</div>
							<div class="card-body">
								<ul class="list-group" id="green">
									<?php
							foreach($Objectives->result() as $row){
								if($row->country=="INDIA"){
						?>
									<li class="list-group-item">
										<?php echo $row->objective; ?>
									</li>

									<?php 
								}
							} 
						?>
								</ul>
							</div>

						</div>
						<div class="card">
							<div class="row">
								<div class="col">
									<img src="<?php echo base_url('assets/images/OverView/china.png'); ?>"
										class="img-fluid border" alt="..." style="margin: 5px;">
								</div>
								<div class="col" style="margin-top: 5px; margin-right: 5px;">
									<ul class="list-group">
										<li class="list-group-item">
											<span class="text-bold">
												Available assets
											</span>
											<span id="china-available">
												1,110,000
											</span>
										</li>
										<li class="list-group-item">
											<span class="text-bold">
												Destroyed assets
											</span>
											<span id="china-destroyed">
												10,000
											</span>
										</li>

									</ul>
									<div style="font-size: 40px; margin-top: 5px;" class="text-bold defcon-2"
										id="china-defcon" data-defcon="2">
										<?php if($Objectives->num_rows()>0){echo $Objectives->row()->defcon; }  ?>
									</div>

								</div>
							</div>

							<div class="card-body">
								<!-- <h5 class="card-title">Card title</h5> -->
								<ul class="list-group" id="yellow">
									<?php
							foreach($Objectives->result() as $row){
								if($row->country=="CHINA"){
						?>
									<li class="list-group-item">
										<?php echo $row->objective; ?>
									</li>

									<?php 
								}
							} 
						?>
								</ul>
							</div>

						</div>
						<div class="card">
							<div class="row">
								<div class="col">
									<img src="<?php echo base_url('assets/images/OverView/russia.png'); ?>"
										class="img-fluid border" alt="..." style="margin: 5px;">

								</div>
								<div class="col" style="margin-top: 5px; margin-right: 5px;">
									<ul class="list-group">
										<li class="list-group-item">
											<span class="text-bold">
												Available assets
											</span>
											<span id="russia-available">
												1,110,000
											</span>
										</li>
										<li class="list-group-item">
											<span class="text-bold">
												Destroyed assets
											</span>
											<span id="russia-destroyed">
												10,000
											</span>
										</li>

									</ul>
									<div style="font-size: 40px; margin-top: 5px;" class="text-bold defcon"
										id="russia-defcon" data-defcon="1">
										<?php if($Objectives->num_rows()>0){echo $Objectives->row()->defcon; }  ?>
									</div>

								</div>
							</div>

							<div class="card-body">
								<ul class="list-group" id="red">
									<?php
							foreach($Objectives->result() as $row){
								if($row->country=="RUSSIA"){
						?>
									<li class="list-group-item">
										<?php echo $row->objective; ?>
									</li>

									<?php 
								}
							} 
						?>
								</ul>
							</div>

						</div>
					</div>
				</div>
				<div class="carousel-item" data-bs-interval="5000">
					<div class="card-group">
						<div class="card">

							<img src="<?php echo base_url('assets/images/OverView/usa.png'); ?>" class="img-fluid border"
								alt="..." style="margin: 5px;">


							<div class="col-md-12 overflow-auto" style="height:500px;">
								<table class="table table-striped table-hover" id="tbl-seaBase">
									<thead class="border">
										<tr>
											<th class="text-secondary">#</th>
											<th class="text-secondary">Asset Name</th>
											<th class="text-secondary">Image</th>
											<th class="text-primary">No. of Assets</th>
											<th class="text-danger text-center">Destroyed</th>
											<th class="text-success text-center">Alive</th>

										</tr>
									</thead>
									<tbody>
										<?php
										$no=0;
							$CI = get_instance();
							
							foreach($summary->result() as $row)
							{   if($row->teamId=='1'){
								$no++;
								?>
										<tr class="align-middle">
											<td class="text-secondary">
												<?php echo $no; ?>
											</td>

											<td class="text-secondary">
												<?php echo $row->name; ?>
											</td>
											<td class="text-secondary">

												<img src="<?php echo base_url('assets/images/GameAssets/'.$row->image); ?>"
													width="50" height="50" alt="">
											</td>

											<td class="text-primary  text-center">
												<?php echo ($row->quantity); ?>
											</td>
											<td class="text-danger  text-center">
												<?php echo ($row->destroyed); ?>
											</td>
											<td class="text-success  text-center">
												<?php echo ($row->remainingAssets); ?>
											</td>
										</tr>
										<?php
								}
								}
								?>
									</tbody>
								</table>
							</div>
						</div>
						
						<div class="card">

							<img src="<?php echo base_url('assets/images/OverView/india.png'); ?>" <div
								class="col-md-12 overflow-auto" style="height:500px;">
							<table class="table table-striped table-hover" id="tbl-seaBase">
								<thead class="border">
									<tr>
										<th class="text-secondary">#</th>
										<th class="text-secondary">Asset Name</th>
										<th class="text-secondary">Image</th>
										<th class="text-primary">No. of Assets</th>
										<th class="text-danger text-center">Destroyed</th>
										<th class="text-success text-center">Alive</th>

									</tr>
								</thead>
								<tbody>
									<?php
									$no=0;
						$CI = get_instance();
						
						foreach($summary->result() as $row)
						{   if($row->teamId=='5'){
							$no++;
							?>
									<tr class="align-middle">
										<td class="text-secondary">
											<?php echo $no; ?>
										</td>

										<td class="text-secondary">
											<?php echo $row->name; ?>
										</td>
										<td class="text-secondary">

											<img src="<?php echo base_url('assets/images/GameAssets/'.$row->image); ?>"
												width="50" height="50" alt="">
										</td>

										<td class="text-primary  text-center">
											<?php echo ($row->quantity); ?>
										</td>
										<td class="text-danger  text-center">
											<?php echo ($row->destroyed); ?>
										</td>
										<td class="text-success  text-center">
											<?php echo ($row->remainingAssets); ?>
										</td>
									</tr>
									<?php
							}
							}
							?>
								</tbody>
							</table>
						</div>
						
						<div class="card">

							<img src="<?php echo base_url('assets/images/OverView/china.png'); ?>" class="img-fluid border"
								alt="..." style="margin: 5px;">

							<div class="col-md-12 overflow-auto" style="height:500px;">
								<table class="table table-striped table-hover" id="tbl-seaBase">
									<thead class="border">
										<tr>
											<th class="text-secondary">#</th>
											<th class="text-secondary">Asset Name</th>
											<th class="text-secondary">Image</th>
											<th class="text-primary">No. of Assets</th>
											<th class="text-danger text-center">Destroyed</th>
											<th class="text-success text-center">Alive</th>

										</tr>
									</thead>
									<tbody>
										<?php
									$no=0;
						$CI = get_instance();
						
						foreach($summary->result() as $row)
						{   if($row->teamId=='2'){
							$no++;
							?>
										<tr class="align-middle">
											<td class="text-secondary">
												<?php echo $no; ?>
											</td>

											<td class="text-secondary">
												<?php echo $row->name; ?>
											</td>
											<td class="text-secondary">

												<img src="<?php echo base_url('assets/images/GameAssets/'.$row->image); ?>"
													width="50" height="50" alt="">
											</td>

											<td class="text-primary  text-center">
												<?php echo ($row->quantity); ?>
											</td>
											<td class="text-danger  text-center">
												<?php echo ($row->destroyed); ?>
											</td>
											<td class="text-success  text-center">
												<?php echo ($row->remainingAssets); ?>
											</td>
										</tr>
										<?php
							}
							}
							?>
									</tbody>
								</table>
							</div>
						</div>
						
						
						<div class="card">


							<img src="<?php echo base_url('assets/images/OverView/russia.png'); ?>" <div
								class="col-md-12 overflow-auto" style="height:500px;">
							<table class="table table-striped table-hover" id="tbl-seaBase">
								<thead class="border">
									<tr>
										<th class="text-secondary">#</th>
										<th class="text-secondary">Asset Name</th>
										<th class="text-secondary">Image</th>
										<th class="text-primary">No. of Assets</th>
										<th class="text-danger text-center">Destroyed</th>
										<th class="text-success text-center">Alive</th>

									</tr>
								</thead>
								<tbody>
									<?php
													$no=0;
										$CI = get_instance();
										
										foreach($summary->result() as $row)
										{   if($row->teamId=='6'){
											$no++;
											?>
									<tr class="align-middle">
										<td class="text-secondary">
											<?php echo $no; ?>
										</td>

										<td class="text-secondary">
											<?php echo $row->name; ?>
										</td>
										<td class="text-secondary">

											<img src="<?php echo base_url('assets/images/GameAssets/'.$row->image); ?>"
												width="50" height="50" alt="">
										</td>

										<td class="text-primary  text-center">
											<?php echo ($row->quantity); ?>
										</td>
										<td class="text-danger  text-center">
											<?php echo ($row->destroyed); ?>
										</td>
										<td class="text-success  text-center">
											<?php echo ($row->remainingAssets); ?>
										</td>
									</tr>
									<?php
											}
											}
											?>
								</tbody>
							</table>
						</div>
					</div>
					

				</div>
				
			</div>
		</div>
	</div>

	</div>



	<audio id="audioPlayer">
		<source src="<?php echo base_url('assets/audio/defcon1.mp3'); ?>" type="audio/mpeg">
	</audio>
</body>
<script src="<?php echo base_url('assets/js/bootstrap.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/socketio.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/clock/rx.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/clock/rx2.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/clock/hammer.js'); ?>"></script>

<script>
	let defconUrl = `http://122.53.86.62:1945/Team_Controller/loadDesAndAvailAssets`

	document.addEventListener("DOMContentLoaded", async function () {
		const fetchPromise = await fetch(`${defconUrl}`);
		let teams = await fetchPromise.json()

		teams.forEach((team) => {
			if (team.country == 'United Nations') {
				return
			}
			console.log(team)
			let subteam = team.country.toLowerCase();
			let defcon = team.defcon.slice(-1)


			updateDefcon(defcon, subteam, team.remainingAssets, team.destroyed)

		})
	})


	let timeObj = Date.now() / 1000
	let x = 1

	function computeTranslatedTime() {
		let nowTime = Date.now() / 1000
		let diff = nowTime - timeObj
		let newTime = (diff * 24)*x + nowTime
		console.log(Date(newTime))
	}

	setInterval(computeTranslatedTime, 1000);



	function updateDefcon(defcon, team, avail, destroy) {
		let ele = document.getElementById(`${team}-defcon`)
		let available = document.getElementById(`${team}-available`)
		let destroyed = document.getElementById(`${team}-destroyed`)

		ele.dataset['defcon'] = defcon
		ele.innerHTML = `DEFCON ${defcon}`
		available.innerHTML = avail.toLocaleString();;
		destroyed.innerHTML = destroy.toLocaleString();;

	}
	let host = '122.53.86.62:3000/'
	// let host = 'http://localhost:8000/'
	const socket = io(host);

	socket.on("requestDefcon", (data) => {
		console.log(data)
		let defcon = data.defcon.slice(-1)
		let team = data.teamName.toLowerCase();
		updateDefcon(defcon, team)
		if (data['defcon'] == "DEFCON 1") {
			var audio = document.getElementById("audioPlayer");
			audio.play();
		}
	})

	socket.on("connect", () => {
		socket.emit("setDisplay")
	});
	socket.on("objectiveUpdate_overall", data => {
		console.log(data)
		document.getElementById(data.team_id).childNodes[((parseInt(data.id) - 1) * 2) + 1].classList.add(data
			.result ? "item-done" : "item-fail")
	})
	const timeElm = document.getElementById('time');
	const doc = document.documentElement;
	const {
		clientWidth,
		clientHeight
	} = doc;

	const pad = val => val < 10 ? `0${val}` : val;
	var futureTime = new Date(Date.now() + (3600 * 1000 * 8)).getTime();

	const animationFrame$ = Rx.Observable.interval(0, Rx.Scheduler.animationFrame);

	const time$ = Rx.Observable.
	interval(1000).
	map(() => {
		var now = new Date().getTime();
		var distance = futureTime - now;

		return {
			hours: Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
			minutes: Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)),
			seconds: Math.floor((distance % (1000 * 60)) / 1000)
		};

	}).
	subscribe(({
		hours,
		minutes,
		seconds
	}) => {
		timeElm.setAttribute('data-hours', pad(hours));
		timeElm.setAttribute('data-minutes', pad(minutes));
		timeElm.setAttribute('data-seconds', pad(seconds));
	});

	// const mouse$ = Rx.Observable.
	//     fromEvent(document, 'mousemove').
	//     map(({ clientX, clientY }) => ({
	//         x: (clientWidth / 2 - clientX) / clientWidth,
	//         y: (clientHeight / 2 - clientY) / clientHeight
	//     }));


	// const smoothMouse$ = animationFrame$.
	//     withLatestFrom(mouse$, (_, m) => m).
	//     scan(RxCSS.lerp(0.1));

	RxCSS(
		timeElm);

</script>

</html>
